var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf3=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _react=_interopRequireWildcard(require("react"));var _classnames2=_interopRequireDefault(require("classnames"));var _betterScroll=_interopRequireDefault(require("better-scroll"));var _validate=require("../utils/validate");var _jsxFileName="/Users/linji/Documents/workspace/zarm/zarm/components/wheel/Wheel.tsx";var getValue=function getValue(props,defaultValue){if('value'in props){return props.value;}if('defaultValue'in props){return props.defaultValue;}if((0,_validate.isArray)(props.dataSource)&&props.dataSource[0]){return props.dataSource[0][props.valueMember];}return defaultValue;};var Wheel=function(_Component){(0,_inherits2.default)(Wheel,_Component);function Wheel(){var _getPrototypeOf2;var _this;(0,_classCallCheck2.default)(this,Wheel);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=(0,_possibleConstructorReturn2.default)(this,(_getPrototypeOf2=(0,_getPrototypeOf3.default)(Wheel)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.getSelectedIndex=function(value,dataSource){var valueMember=_this.props.valueMember;var index;dataSource.some(function(item,i){if(item[valueMember]===value){index=i;return true;}return false;});return index;};_this.fireValueChange=function(value){var currentValue=getValue(_this.props);if(value===currentValue){return;}var onChange=_this.props.onChange;if(typeof onChange==='function'){onChange(value);}};return _this;}(0,_createClass2.default)(Wheel,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;var _this$props=this.props,prefixCls=_this$props.prefixCls,dataSource=_this$props.dataSource,disabled=_this$props.disabled,onTransition=_this$props.onTransition,valueMember=_this$props.valueMember;var value=getValue(this.props);var initIndex=this.getSelectedIndex(value,dataSource);this.BScroll=new _betterScroll.default(this.wrapper,{wheel:{selectedIndex:initIndex,wheelWrapperClass:prefixCls+"-content",wheelItemClass:prefixCls+"-item"},probeType:3});disabled&&this.BScroll.disable();this.BScroll.on('scroll',function(){if(typeof onTransition==='function'){onTransition(_this2.BScroll.isInTransition);}});this.BScroll.on('scrollEnd',function(){var curDataSource=_this2.props.dataSource;if(_this2.isChangedByProps){_this2.isChangedByProps=false;return;}var index=_this2.BScroll.getSelectedIndex();var child=curDataSource[index];onTransition(_this2.BScroll.isInTransition);if(child){_this2.fireValueChange(child[valueMember]);}});}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){var _this$props2=this.props,value=_this$props2.value,dataSource=_this$props2.dataSource,disabled=_this$props2.disabled;disabled&&this.BScroll.disable();this.BScroll.refresh();var oldIndex=this.getSelectedIndex(prevProps.value,prevProps.dataSource);var newIndex=this.getSelectedIndex(value,dataSource);if(newIndex!==oldIndex){this.isChangedByProps=true;this.BScroll.wheelTo(newIndex);}}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.BScroll.destroy();}},{key:"render",value:function render(){var _this3=this;var _this$props3=this.props,prefixCls=_this$props3.prefixCls,className=_this$props3.className,valueMember=_this$props3.valueMember,dataSource=_this$props3.dataSource,itemRender=_this$props3.itemRender,disabled=_this$props3.disabled;var value=getValue(this.props);var items=dataSource.map(function(item,index){var _classnames;var itemCls=(0,_classnames2.default)(prefixCls+"__item",(_classnames={},(0,_defineProperty2.default)(_classnames,prefixCls+"__item--selected",value===item[valueMember]),(0,_defineProperty2.default)(_classnames,prefixCls+"__item--disabled",disabled),_classnames));return _react.default.createElement("div",{key:+index,className:itemCls,__self:_this3,__source:{fileName:_jsxFileName,lineNumber:135}},itemRender(item));});var rollerCls=(0,_classnames2.default)(prefixCls,className);return _react.default.createElement("div",{className:rollerCls,ref:function ref(wrapper){_this3.wrapper=wrapper;},__self:this,__source:{fileName:_jsxFileName,lineNumber:144}},_react.default.createElement("div",{className:prefixCls+"__content",__self:this,__source:{fileName:_jsxFileName,lineNumber:148}},items));}}]);return Wheel;}(_react.Component);exports.default=Wheel;Wheel.defaultProps={prefixCls:'za-wheel',dataSource:[],valueMember:'value',itemRender:function itemRender(item){return item.label;}};