var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.unlockBodyScroll=exports.clearAllBodyScrollLocks=exports.lockBodyScroll=void 0;var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));var _events=_interopRequireDefault(require("./events"));var isIosDevice=typeof window!=='undefined'&&window.navigator&&window.navigator.platform&&/iP(ad|hone|od)/.test(window.navigator.platform);var locks=[];var documentListenerAdded=false;var initialClientY=-1;var previousBodyOverflowSetting;var previousBodyPaddingRight;var allowTouchMove=function allowTouchMove(el){return locks.some(function(lock){if(lock.options.allowTouchMove&&lock.options.allowTouchMove(el)){return true;}return false;});};var preventDefault=function preventDefault(rawEvent){var e=rawEvent||window.event;if(e.target&&allowTouchMove(e.target)){return true;}if(e.touches.length>1)return true;if(e.preventDefault)e.preventDefault();return false;};var setOverflowHidden=function setOverflowHidden(options){setTimeout(function(){if(previousBodyPaddingRight===undefined){var reserveScrollBarGap=!!options&&options.reserveScrollBarGap===true;var scrollBarGap=window.innerWidth-document.documentElement.clientWidth;if(reserveScrollBarGap&&scrollBarGap>0){previousBodyPaddingRight=document.body.style.paddingRight;document.body.style.paddingRight=scrollBarGap+"px";}}if(previousBodyOverflowSetting===undefined){previousBodyOverflowSetting=document.body.style.overflow;document.body.style.overflow='hidden';}});};var restoreOverflowSetting=function restoreOverflowSetting(){setTimeout(function(){if(previousBodyPaddingRight!==undefined){document.body.style.paddingRight=previousBodyPaddingRight;previousBodyPaddingRight=undefined;}if(previousBodyOverflowSetting!==undefined){document.body.style.overflow=previousBodyOverflowSetting;previousBodyOverflowSetting=undefined;}});};var isTargetElementTotallyScrolled=function isTargetElementTotallyScrolled(targetElement){return targetElement?targetElement.scrollHeight-targetElement.scrollTop<=targetElement.clientHeight:false;};var handleScroll=function handleScroll(event,targetElement){var clientY=event.targetTouches[0].clientY-initialClientY;if(event.target&&allowTouchMove(event.target)){return false;}if(targetElement&&targetElement.scrollTop===0&&clientY>0){return preventDefault(event);}if(isTargetElementTotallyScrolled(targetElement)&&clientY<0){return preventDefault(event);}event.stopPropagation();return true;};var lockBodyScroll=function lockBodyScroll(targetElement,options){if(isIosDevice){if(!targetElement){console.error('lockBodyScroll unsuccessful - targetElement must be provided when calling lockBodyScroll on IOS devices.');return;}if(targetElement&&!locks.some(function(lock){return lock.targetElement===targetElement;})){var lock={targetElement:targetElement,options:options||{}};locks=[].concat((0,_toConsumableArray2.default)(locks),[lock]);targetElement.ontouchstart=function(event){if(event.targetTouches.length===1){initialClientY=event.targetTouches[0].clientY;}};targetElement.ontouchmove=function(event){if(event.targetTouches.length===1){handleScroll(event,targetElement);}};if(!documentListenerAdded){_events.default.on(document,'touchmove',preventDefault);documentListenerAdded=true;}}}else{setOverflowHidden(options);var _lock={targetElement:targetElement,options:options||{}};locks=[].concat((0,_toConsumableArray2.default)(locks),[_lock]);}};exports.lockBodyScroll=lockBodyScroll;var clearAllBodyScrollLocks=function clearAllBodyScrollLocks(){if(isIosDevice){locks.forEach(function(lock){lock.targetElement.ontouchstart=null;lock.targetElement.ontouchmove=null;});if(documentListenerAdded){_events.default.off(document,'touchmove',preventDefault);documentListenerAdded=false;}locks=[];initialClientY=-1;}else{restoreOverflowSetting();locks=[];}};exports.clearAllBodyScrollLocks=clearAllBodyScrollLocks;var unlockBodyScroll=function unlockBodyScroll(targetElement){if(isIosDevice){if(!targetElement){console.error('unlockBodyScroll unsuccessful - targetElement must be provided when calling unlockBodyScroll on IOS devices.');return;}targetElement.ontouchstart=null;targetElement.ontouchmove=null;locks=locks.filter(function(lock){return lock.targetElement!==targetElement;});if(documentListenerAdded&&locks.length===0){_events.default.off(document,'touchmove',preventDefault);documentListenerAdded=false;}}else{locks=locks.filter(function(lock){return lock.targetElement!==targetElement;});if(!locks.length){restoreOverflowSetting();}}};exports.unlockBodyScroll=unlockBodyScroll;