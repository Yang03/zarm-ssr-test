var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _react=_interopRequireWildcard(require("react"));var _reactDom=_interopRequireDefault(require("react-dom"));var _classnames4=_interopRequireDefault(require("classnames"));var _events=_interopRequireDefault(require("../utils/events"));var _dom=require("../utils/dom");var _mask=_interopRequireDefault(require("../mask"));var _jsxFileName="/Users/linji/Documents/workspace/zarm/zarm/components/popup/Portal.tsx";var IS_REACT_16=!!_reactDom.default.createPortal;var Portal=function(_PureComponent){(0,_inherits2.default)(Portal,_PureComponent);function Portal(props){var _this;(0,_classCallCheck2.default)(this,Portal);_this=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(Portal).call(this,props));_this.animationEnd=function(e){if(e.target!==_this.popup){return;}e.stopPropagation();var _this$props=_this.props,afterClose=_this$props.afterClose,afterOpen=_this$props.afterOpen,handlePortalUnmount=_this$props.handlePortalUnmount,visible=_this$props.visible,prefixCls=_this$props.prefixCls;var animationState=visible?'enter':'leave';if(animationState==='leave'){_this._container.classList.add(prefixCls+"--hidden");if(typeof afterClose==='function'){afterClose();}if(typeof handlePortalUnmount==='function'){handlePortalUnmount();}}else if(typeof afterOpen==='function'){afterOpen();}};_this.renderMask=function(){var _this$props2=_this.props,mask=_this$props2.mask,maskType=_this$props2.maskType,animationDuration=_this$props2.animationDuration,visible=_this$props2.visible;var isPending=_this.state.isPending;var animationState=visible?'enter':'leave';var maskCls=(0,_classnames4.default)((0,_defineProperty2.default)({},"za-fade-"+animationState,isPending));var maskStyle={WebkitAnimationDuration:animationDuration+"ms",animationDuration:animationDuration+"ms"};return mask&&_react.default.createElement(_mask.default,{className:maskCls,style:maskStyle,visible:true,type:maskType,__self:(0,_assertThisInitialized2.default)(_this),__source:{fileName:_jsxFileName,lineNumber:107}});};_this.handleMaskClick=function(e){e.stopPropagation();var onMaskClick=_this.props.onMaskClick;if(typeof onMaskClick==='function'&&_this.popup!==e.target&&_this.popup&&!_this.popup.contains(e.target)){onMaskClick();}};_this.getComponent=function(){var _classnames3;var _this$props3=_this.props,prefixCls=_this$props3.prefixCls,animationType=_this$props3.animationType,animationDuration=_this$props3.animationDuration,direction=_this$props3.direction,mask=_this$props3.mask,children=_this$props3.children,width=_this$props3.width,visible=_this$props3.visible;var isPending=_this.state.isPending;var animationState=visible?'enter':'leave';var cls={wrapper:(0,_classnames4.default)(prefixCls+"__wrapper",(0,_defineProperty2.default)({},"za-fade-"+animationState,direction==='center'&&isPending)),popup:(0,_classnames4.default)(prefixCls,(_classnames3={},(0,_defineProperty2.default)(_classnames3,prefixCls+"--"+direction,!!direction),(0,_defineProperty2.default)(_classnames3,prefixCls+"--nomask",direction==='center'&&!mask),(0,_defineProperty2.default)(_classnames3,"za-"+animationType+"-"+animationState,direction==='center'&&isPending),_classnames3))};var wrapStyle=direction==='center'?{WebkitAnimationDuration:animationDuration+"ms",animationDuration:animationDuration+"ms"}:{};var popupStyle=direction==='center'?{width:width,WebkitAnimationDuration:animationDuration+"ms",animationDuration:animationDuration+"ms"}:{WebkitTransitionDuration:animationDuration+"ms",transitionDuration:animationDuration+"ms",WebkitTransitionProperty:'transform',transitionProperty:'transform'};if(!mask){return _react.default.createElement("div",{className:cls.popup,style:popupStyle,role:"dialog",ref:function ref(_ref){_this.popup=_ref;},__self:(0,_assertThisInitialized2.default)(_this),__source:{fileName:_jsxFileName,lineNumber:173}},children);}return _react.default.createElement(_react.default.Fragment,null,_this.renderMask(),_react.default.createElement("div",{role:"dialog",className:cls.wrapper,style:wrapStyle,onClick:function onClick(e){_this.handleMaskClick(e);},__self:(0,_assertThisInitialized2.default)(_this),__source:{fileName:_jsxFileName,lineNumber:189}},_react.default.createElement("div",{ref:function ref(_ref2){_this.popup=_ref2;},className:cls.popup,style:popupStyle,role:"document",__self:(0,_assertThisInitialized2.default)(_this),__source:{fileName:_jsxFileName,lineNumber:197}},children)));};_this.handleAnimation=function(){var _this$props4=_this.props,visible=_this$props4.visible,prefixCls=_this$props4.prefixCls;if(visible){if(_this.popup){_this._container.classList.remove(prefixCls+"--hidden");_this.setState({isPending:true});_this.popup.focus();_this.popup.classList.add(prefixCls+"--show");}}else{_this.setState({isPending:true});_this.popup.classList.remove(prefixCls+"--show");}};_this.renderPortal=function(){if(!_dom.canUseDOM){return null;}if(!IS_REACT_16){_reactDom.default.unstable_renderSubtreeIntoContainer((0,_assertThisInitialized2.default)(_this),_this.getComponent(),_this._container);return null;}return _reactDom.default.createPortal(_this.getComponent(),_this._container);};_this.createContainer=function(){var _this$props5=_this.props,_this$props5$classNam=_this$props5.className,className=_this$props5$classNam===void 0?'':_this$props5$classNam,prefixCls=_this$props5.prefixCls,mountContainer=_this$props5.mountContainer;if(!_this._container){_this._container=document.createElement('div');_this._container.className+=prefixCls+"-container "+className;_this.mountNode=(0,_dom.getMountContainer)(mountContainer);_this.mountNode.appendChild(_this._container);}return _this._container;};_this.state={isPending:false};_this.createContainer();return _this;}(0,_createClass2.default)(Portal,[{key:"componentDidMount",value:function componentDidMount(){_events.default.on(this.popup,'webkitTransitionEnd',this.animationEnd);_events.default.on(this.popup,'transitionend',this.animationEnd);_events.default.on(this.popup,'webkitAnimationEnd',this.animationEnd);_events.default.on(this.popup,'animationend',this.animationEnd);this.handleAnimation();}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){var visible=this.props.visible;if(prevProps.visible!==visible){this.handleAnimation();}}},{key:"componentWillUnmount",value:function componentWillUnmount(){if(this.popup){_events.default.off(this.popup,'webkitTransitionEnd',this.animationEnd);_events.default.off(this.popup,'transitionend',this.animationEnd);_events.default.off(this.popup,'webkitAnimationEnd',this.animationEnd);_events.default.off(this.popup,'animationend',this.animationEnd);}clearTimeout(this.enterTimer);if(this._container){this.mountNode.removeChild(this._container);}}},{key:"render",value:function render(){return this.renderPortal();}}]);return Portal;}(_react.PureComponent);exports.default=Portal;Portal.defaultProps={prefixCls:'za-popup',visible:false,mask:true,direction:'bottom',animationType:'fade',animationDuration:200,maskType:_mask.default.defaultProps.type};