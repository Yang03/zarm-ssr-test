var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _react=_interopRequireWildcard(require("react"));var _classnames=_interopRequireDefault(require("classnames"));var _Month=_interopRequireDefault(require("./Month"));var _date=_interopRequireDefault(require("../utils/date"));var _jsxFileName="/Users/linji/Documents/workspace/zarm/zarm/components/calendar/index.tsx";var CN_DAY_NAME=['日','一','二','三','四','五','六'];var parseState=function parseState(props){var defaultValue=props.defaultValue,multiple=props.multiple;var value=props.value;var tmpValue;value=value||defaultValue;value=Object.prototype.toString.call(value)==='[object Array]'?value:value&&[value]||[];tmpValue=value.slice(0,multiple?2:1).map(function(item){return _date.default.parseDay(item);});tmpValue=tmpValue.sort(function(item1,item2){return+item1-+item2;});var min=props.min?_date.default.parseDay(props.min):new Date();var startMonth=_date.default.cloneDate(min,'dd',1);var max=props.max?_date.default.parseDay(props.max):_date.default.cloneDate(min,'y',1);var endMonth=_date.default.cloneDate(max,'dd',_date.default.getDaysByDate(max));var duration=[min,max].sort(function(item1,item2){return+item1-+item2;});var tmp={value:tmpValue,min:duration[0],max:duration[1],startMonth:startMonth,endMonth:endMonth,refresh:false,steps:multiple?2:1,multiple:multiple};return tmp;};var CalendarView=function(_PureComponent){(0,_inherits2.default)(CalendarView,_PureComponent);function CalendarView(props){var _this;(0,_classCallCheck2.default)(this,CalendarView);_this=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(CalendarView).call(this,props));_this.state=(0,_extends2.default)({},parseState(_this.props),{step:1});_this.handleDateClick=function(date){var _this$state=_this.state,step=_this$state.step,steps=_this$state.steps,value=_this$state.value;var onChange=_this.props.onChange;if(step===1){value.splice(0,value.length);}value[step-1]=date;value.sort(function(item1,item2){return+item1-+item2;});_this.setState({value:value,step:step>=steps?1:step+1},function(){step>=steps&&typeof onChange==='function'&&onChange(value);});};_this.anchor=function(){var value=_this.state.value;var target=value[0]||CalendarView.now;var key=target.getFullYear()+"-"+target.getMonth();var node=_this.nodes[key];if(node&&Object.prototype.toString.call(node.anchor)==='[object Function]'){node.anchor();}};_this.renderWeekBar=function(){var prefixCls=_this.props.prefixCls;var content=CN_DAY_NAME.map(function(week){return _react.default.createElement("li",{key:week,className:prefixCls+"__bar__item",__self:(0,_assertThisInitialized2.default)(_this),__source:{fileName:_jsxFileName,lineNumber:175}},week);});return _react.default.createElement("ul",{className:prefixCls+"__bar",__self:(0,_assertThisInitialized2.default)(_this),__source:{fileName:_jsxFileName,lineNumber:179}},content);};_this.renderMonth=function(dateMonth){var _this$state2=_this.state,value=_this$state2.value,min=_this$state2.min,max=_this$state2.max;var _this$props=_this.props,prefixCls=_this$props.prefixCls,dateRender=_this$props.dateRender,disabledDate=_this$props.disabledDate;var key=dateMonth.getFullYear()+"-"+dateMonth.getMonth();return _react.default.createElement(_Month.default,{prefixCls:prefixCls,key:key,min:min,max:max,value:value,dateMonth:dateMonth,dateRender:dateRender,disabledDate:disabledDate,onDateClick:_this.handleDateClick,ref:function ref(n){_this.nodes[key]=n;},__self:(0,_assertThisInitialized2.default)(_this),__source:{fileName:_jsxFileName,lineNumber:187}});};_this.nodes={};return _this;}(0,_createClass2.default)(CalendarView,[{key:"componentDidMount",value:function componentDidMount(){this.anchor();}},{key:"componentDidUpdate",value:function componentDidUpdate(_prevProps,prevState){var refresh=this.state.refresh;if(refresh!==prevState.refresh){this.anchor();}}},{key:"renderMonths",value:function renderMonths(){var _this2=this;var prefixCls=this.props.prefixCls;var _this$state3=this.state,startMonth=_this$state3.startMonth,max=_this$state3.max;var arr=Array.from({length:_date.default.getMonthCount(startMonth,max)});var content=arr.map(function(_item,i){return _this2.renderMonth(_date.default.cloneDate(startMonth,'m',i));});return _react.default.createElement("section",{className:prefixCls+"__body",__self:this,__source:{fileName:_jsxFileName,lineNumber:208}},content);}},{key:"render",value:function render(){var _this$props2=this.props,prefixCls=_this$props2.prefixCls,className=_this$props2.className;return _react.default.createElement("div",{className:(0,_classnames.default)(prefixCls,className),__self:this,__source:{fileName:_jsxFileName,lineNumber:214}},this.renderWeekBar(),this.renderMonths());}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(nextProps,prevState){if('value'in nextProps&&nextProps.value!==prevState.prevValue||'multiple'in nextProps&&nextProps.multiple!==prevState.prevMultiple||'min'in nextProps&&nextProps.min!==prevState.prevMin||'max'in nextProps&&nextProps.max!==prevState.prevMax){return(0,_extends2.default)({},parseState(nextProps),{step:prevState.step?1:prevState.step,refresh:!prevState.refresh,prevValue:nextProps.value,prevMax:nextProps.max,prevMin:nextProps.min,prevMultiple:nextProps.multiple});}return null;}}]);return CalendarView;}(_react.PureComponent);exports.default=CalendarView;CalendarView.displayName='CalendarView';CalendarView.defaultProps={prefixCls:'za-calendar',multiple:false,min:new Date(),dateRender:function dateRender(date){return date.getDate();},disabledDate:function disabledDate(){return false;}};CalendarView.now=new Date();CalendarView.cache={now:CalendarView.now.getFullYear()+"-"+CalendarView.now.getMonth()+"-"+CalendarView.now.getDate()};